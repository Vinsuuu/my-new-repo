<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SIMS - Student Information Management System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding: 90px;
      background: linear-gradient(90deg, rgba(5, 93, 176, 1) 25%, rgba(117, 219, 240, 1) 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container-fluid {
      max-width: 1300px;
      background-color: #ffffff;
      border-radius: 20px;
      box-shadow: 20px 10px 25px rgba(0, 0, 0, 0.08);
      padding: 30px;
      border: 5px solid #dee2e6;
    }
    .card {
      border-radius: 20px;
      box-shadow: 20px 4px 12px rgba(0, 0, 0, .05);
      border: none;
    }
    .register-card, .filter-card, .student-records-card {
      border: 3px solid #0D6EFD;
      box-shadow: 0 4px 15px rgba(25, 135, 84, 0.15);
    }
    .search-input-group {
      border: 2px solid #ced4da;
      border-radius: 50px;
      overflow: hidden;
    }
    #searchBtn {
      color: #ffffff;
      background-color: #000ed8;
      border: none;
      border-radius: 0 50px 50px 0 !important;
      margin-left: -1px;
    }
    #searchBtn:hover {
      background-color: #4063d4;
    }
    .table thead {
      background-color: #e9ecef;
      color: #2580db;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .table-hover tbody tr:hover {
      background-color: #e0f7fa;
    }
    .scrollable-table-container {
      max-height: 380px;
      overflow-y: auto;
      border: 1px solid #ced4da;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <h1 class="mb-4 text-primary fw-bold">Student Information Management System</h1>

    <div class="row g-4">
      <div class="col-lg-4">
        <div class="card p-4 mb-4 register-card">
          <h5 class="card-title text-primary mb-3">Register New Student</h5>
          <form id="studentForm">
            <div class="mb-2">
              <label class="form-label fw-semibold">Student ID</label>
              <input required type="text" id="studentId" class="form-control" placeholder="e.g., 211-000">
            </div>
            <div class="mb-2">
              <label class="form-label fw-semibold">Full Name</label>
              <input required type="text" id="fullName" class="form-control" placeholder="e.g., Jane Doe">
            </div>
            <div class="mb-2">
              <label class="form-label fw-semibold">Gender</label>
              <select required id="gender" class="form-select">
                <option value="">Select Gender</option>
                <option>Male</option>
                <option>Female</option>
                <option>Other</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label fw-semibold">Gmail</label>
              <input required type="email" id="gmail" class="form-control" placeholder="e.g., jane.doe@gmail.com">
            </div>
            <div class="mb-2">
              <label class="form-label fw-semibold">Program</label>
              <input required type="text" id="program" class="form-control" placeholder="e.g., BS Computer Science">
            </div>
            <div class="mb-2">
              <label class="form-label fw-semibold">Year Level</label>
              <input required type="number" id="yearLevel" class="form-control" min="1" max="6" placeholder="1-6">
            </div>
            <div class="mb-3">
              <label class="form-label fw-semibold">University</label>
              <input required type="text" id="university" class="form-control" placeholder="e.g., State University">
            </div>
            <button type="submit" class="btn btn-primary w-100 fw-bold">Add Student</button>
          </form>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card p-4 mb-4 filter-card">
          <h5 class="card-title text-primary mb-3">Search & Filter</h5>
          <div class="input-group mb-3 search-input-group">
            <input id="searchQuery" class="form-control" placeholder="Search ID, Name, or Program...">
            <button id="searchBtn" class="btn btn-primary">üîç</button>
          </div>
          <div class="d-flex gap-2">
            <select id="filterGender" class="form-select">
              <option value="">All Genders</option>
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
            <input id="filterProgram" class="form-control" placeholder="Filter Program...">
            <button id="clearFilter" class="btn btn-danger">Clear</button>
          </div>
        </div>

        <div class="card p-4 student-records-card">
          <h5 class="card-title mb-3 text-primary d-flex justify-content-between align-items-center">
            Student Records
            <span id="studentCount" class="badge bg-primary rounded-pill">0 Records</span>
          </h5>

          <div class="table-responsive scrollable-table-container">
            <table class="table table-striped table-hover align-middle" id="studentsTable">
              <thead>
                <tr>
                  <th>Actions</th>
                  <th>Student ID</th>
                  <th>Full Name</th>
                  <th>Gender</th>
                  <th>Program</th>
                  <th>Year</th>
                  <th>University</th>
                </tr>
              </thead>
              <tbody id="studentsTbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://simsmidterm.onrender.com';
    const studentForm = document.getElementById('studentForm');
    const studentCount = document.getElementById('studentCount');

    async function fetchStudents(params = {}) {
      const url = new URL(API_BASE + '/students');
      Object.keys(params).forEach(k => { if (params[k]) url.searchParams.set(k, params[k]); });
      const res = await fetch(url);
      return res.json();
    }

    async function addStudent(payload) {
      const res = await fetch(API_BASE + '/students', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Failed to add student');
      return data;
    }

    async function deleteStudent(id) {
      const res = await fetch(API_BASE + '/students/' + id, { method: 'DELETE' });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Delete failed');
      return data;
    }

    function renderStudents(list) {
      const tbody = document.getElementById('studentsTbody');
      tbody.innerHTML = '';
      const count = list.length;
      studentCount.textContent = `${count} Record${count !== 1 ? 's' : ''}`;
      if (!count) {
        tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted py-4"><i class="bi bi-info-circle"></i> No student records found.</td></tr>';
        return;
      }
      list.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><button class="btn btn-sm btn-danger btn-delete" data-id="${s.id}">üóë Delete</button></td>
          <td>${s.studentId}</td>
          <td>${s.fullName}</td>
          <td>${s.gender || 'N/A'}</td>
          <td>${s.program || 'N/A'}</td>
          <td>${s.yearLevel || 'N/A'}</td>
          <td>${s.university || 'N/A'}</td>
        `;
        tbody.appendChild(tr);
      });
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const id = e.currentTarget.dataset.id;
          if (!confirm(`Confirm deletion of student ID ${id}?`)) return;
          try {
            await deleteStudent(id);
            loadAndRender();
            alert('Student deleted successfully!');
          } catch (err) {
            alert(err.message || 'Delete failed.');
          }
        });
      });
    }

    async function loadAndRender() {
      const q = document.getElementById('searchQuery').value.trim();
      const gender = document.getElementById('filterGender').value;
      const program = document.getElementById('filterProgram').value.trim();
      try {
        const students = await fetchStudents({ q, gender, program });
        renderStudents(students);
      } catch (e) {
        console.error(e);
        renderStudents([]);
        studentCount.textContent = '0 Records (API Error)';
      }
    }

    studentForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        studentId: studentId.value.trim(),
        fullName: fullName.value.trim(),
        gender: gender.value,
        gmail: gmail.value.trim(),
        program: program.value.trim(),
        yearLevel: Number(yearLevel.value),
        university: university.value.trim()
      };
      try {
        await addStudent(payload);
        studentForm.reset();
        loadAndRender();
      } catch (err) {
        alert(err.message || 'Add failed.');
      }
    });

    document.getElementById('searchBtn').addEventListener('click', loadAndRender);
    document.getElementById('filterGender').addEventListener('change', loadAndRender);
    document.getElementById('filterProgram').addEventListener('input', loadAndRender);
    document.getElementById('clearFilter').addEventListener('click', () => {
      searchQuery.value = '';
      filterGender.value = '';
      filterProgram.value = '';
      loadAndRender();
    });
    window.addEventListener('load', loadAndRender);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
